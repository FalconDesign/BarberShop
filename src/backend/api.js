"use strict";function serverApi(e,o){var t=USER_ID+"/data.json",n=cache_1.fakeDemoRedisCache.get(t);if(void 0!==n)return console.log("/data.json Cache Hit"),o.json(n);console.log("/data.json Cache Miss"),db_1.fakeDataBase.get().then(function(e){return cache_1.fakeDemoRedisCache.set(t,e),e}).then(function(e){return o.json(e)})}function createTodoApi(){var e=Router();return e.route("/todos").get(function(e,o){console.log("GET"),setTimeout(function(){o.json(TODOS)},0)}).post(function(e,o){console.log("POST",util.inspect(e.body,{colors:!0}));var t=e.body;return t?(TODOS.push({value:t.value,created_at:new Date,completed:t.completed,id:COUNT++}),o.json(t)):o.end()}),e.param("todo_id",function(e,o,t,n){var d=Number(e.params.todo_id);try{TODOS[d];e.todo_id=d,e.todo=TODOS[d],t()}catch(e){t(new Error("failed to load todo"))}}),e.route("/todos/:todo_id").get(function(e,o){console.log("GET",util.inspect(e.todo,{colors:!0})),o.json(e.todo)}).put(function(e,o){console.log("PUT",util.inspect(e.body,{colors:!0}));var t=TODOS.indexOf(e.todo),n=TODOS[t]=e.body;o.json(n)}).delete(function(e,o){console.log("DELETE",e.todo_id);var t=TODOS.indexOf(e.todo);TODOS.splice(t,1),o.json(e.todo)}),e}Object.defineProperty(exports,"__esModule",{value:!0});var util=require("util"),Router=require("express").Router,db_1=require("./db"),cache_1=require("./cache"),USER_ID="f9d98cf1-1b96-464e-8755-bcc2a5c09077";exports.serverApi=serverApi;var COUNT=4,TODOS=[{id:0,value:"finish example",created_at:new Date,completed:!1},{id:1,value:"add tests",created_at:new Date,completed:!1},{id:2,value:"include development environment",created_at:new Date,completed:!1},{id:3,value:"include production environment",created_at:new Date,completed:!1}];exports.createTodoApi=createTodoApi;